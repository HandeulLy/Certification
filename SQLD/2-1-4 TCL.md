# 2-1-4 TCL



# 1. 트랜잭션 개요

​    \- 트랜잭션 : 데이터베이스의 논리적 최소 연산단위

​    \- TCL : Transaction Control Language, Commit(올바르게 반영된 데이터를 데이터베이스에 반영하는 것), Rollback(트랜잭션 시작 이전의 상태로 되돌리는 것), Savepoint(저장점) 3가지 명령어

| **특성**                    | **설명**                                                     |
| --------------------------- | ------------------------------------------------------------ |
| **원자성****(Atomicity)**   | 트랜잭션에서 정의된 연산들은 모두 성공적으로 실행되던지 전혀 실행되지 않은 상태로 남아 있어야 한다(All or Nothing) |
| **일관성****(Consistency)** | 트랜잭션이 실행되기 전의 데이터베이스 내용이 잘못 되어 있지 않다면 실행 후 데이터베이스 내용에도 잘못이 없어야 한다 |
| **고립성****(Isolation)**   | 트랜잭션이 실행되는 도중에 다른 트랜잭션의 영향으로 잘못된 결과를 만들어서는 안된다 |
| **지속성****(Durability)**  | 트랜잭션이 성공적으로 수행되면 그 트랜잭션이 갱신한 테이터베이스의 내용은 영구적으로 저장된다 |



# 2. COMMIT

​    \- 입력/수정/삭제한 자료에 대해 전혀 문제가 없다고 판단되면 COMMIT 명령어를 통해 트랜잭션을 완료한다

​    \- COMMIT이나 ROLLBACK 이전의 데이터 상태 : 메모리 버퍼에만 영향을 줬기 때문에 데이터 변경 이전 상태로 복구 가능, 현재 사용자는 SELECT 문장으로 결과 확인 가능, 다른 사용자는 현재 사용자가 수행하는 명령의 결과 조회 불가능, 변경된 행은 잠금(LOCKING)되어서 다른 사용자가 변경 불가능

​    \- 즉, COMMIT 명령어는 INSERT, UPDATE, DELETE 명령어 사용 후 변경 작업이 완료되었음을 데이터베이스에게 알려주기 위해 사용 : 데이터에 대한 변경 사항이 데이터베이스에 반영된다, 이전 데이터는 영원히 잃는다, 모든 사용자는 결과 조화가 가능하다



​    \- SQL Server에서 트랜잭션 방식

​    1) AUTO COMMIT : 명령어가 성공적으로 수행되면 자동으로 COMMIT 수행, 오류 발생하면 자동으로 ROLLBACK 수행

​    2) 암시적 트랜잭션 : 트랜잭션의 시작은 DBMS가 처리, 마무리는 사용자가 명시적으로 COMMIT/ROLLBACK 처리(Oracle과 같은 방식)

​    3) 명시적 트랜잭션 : 트랜잭션의 시작과 끝 모두 사용자가 명시적으로 지정



# 3. ROLLBACK

​    \- 테이블 내에 입력/수정/삭제한 데이터에 대해 COMMIT 이전에는 변경 사항을 취소하는 기능

​    \- 데이터 변경 사항이 취소되어 변경 이전 상태로 복구하며, 다른 사용자들이 데이터를 변경할 수 있다



# 4. SAVEPOINT

​    \- ROLLBACK 할 때 트랜잭션에 포함된 전체 작업을 롤백하는 것이 아니라, 현 시점에서 SAVEPOINT로 지정한 부분까지만 롤백하는 것

​    \- 복수의 저장점을 정의할 수 있고, 동일 이름으로 정의할 경우 나중에 정의한 저장점이 유효하다

​    \- 특정 저장점으로 되돌리고 나서 그 점보다 미래 방향으로 되돌릴 수는 없다. 즉, 특정 저장점까지 롤백하면 그 이후에 설정된 저장점들은 무효된다